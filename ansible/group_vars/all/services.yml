services:

  # ---- EDGE NETWORK ----
  root:
    image: ""
    domains:
      - "{{ primary_domain }}"
    cloudflared_enabled: true
    cloudflared_origin_verify: true
    networks: []
    volumes: []
    traefik_enabled: false

  traefik:
    image: "traefik:v3.1.4"
    networks:
      - CF_net
      - internal_net
    volumes:
      - traefik_data
    domains:
      - "{{ traefik_domain }}"
    traefik_enabled: true
    cloudflared_enabled: true
    cloudflared_origin_verify: true

  cloudflared:
    image: "cloudflare/cloudflared:2025.1.0"
    networks:
      - CF_net
    volumes:
      - cloudflared_data
    domains: []
    traefik_enabled: false

  # ---- SECURITY ----  
  crowdsec:
    image: "crowdsecurity/crowdsec:1.6.4"
    networks:
      - management_net
    volumes:
      - crowdsec_data
    domains: []
    traefik_enabled: false

  cf_bouncer:
    image: "crowdsecurity/cloudflare-bouncer:0.0.29"
    networks:
      - management_net
    volumes:
      - cf_bouncer_config
    domains: []
    traefik_enabled: false

  # ---- MONITORING ----    
  grafana:
    image: "grafana/grafana:11.1.0"
    networks:
      - monitoring_net
      - internal_net
    volumes:
      - grafana_data
    domains:
      - "{{ grafana_domain }}"
    traefik_enabled: true
    cloudflared_enabled: true
    cloudflared_origin_verify: true

  prometheus:
    image: "prom/prometheus:v2.53.0"
    networks:
      - monitoring_net
      - internal_net
    volumes:
      - prometheus_data
    domains:
      - "{{ prometheus_domain }}"
    traefik_enabled: true
    cloudflared_enabled: true
    cloudflared_origin_verify: true

  loki:
    image: "grafana/loki:2.9.3"
    networks:
      - monitoring_net
      - internal_net
    volumes:
      - loki_data
      - loki_wal
    domains:
      - "{{ loki_domain }}"
    traefik_enabled: true
    cloudflared_enabled: true
    cloudflared_origin_verify: true

  promtail:
    image: "grafana/promtail:2.9.3"
    networks:
      - monitoring_net
    volumes: []
    domains: []
    traefik_enabled: false

  cadvisor:
    image: "gcr.io/cadvisor/cadvisor:latest"
    networks:
      - monitoring_net
    volumes: []
    domains: []
    traefik_enabled: false

  node_exporter:
    image: "prom/node-exporter:latest"
    networks:
      - monitoring_net
    volumes: []
    domains: []
    traefik_enabled: false

  # ---- OBSERVABILITY & MANAGEMENT ----
  dozzle:
    image: "amir20/dozzle:v9.0.2"
    networks:
      - management_net
      - internal_net
    volumes: []
    domains:
      - "{{ dozzle_domain }}"
    traefik_enabled: true
    cloudflared_enabled: true
    cloudflared_origin_verify: true

